import{e as x,f as c,v as f,p as u,g as D,h as k,u as C,i as b,j as A,k as R,c as I,a as n,b as i,w as y,r as B,t as N,l as p,m as w,F as E,n as F,q as O,s as V,o as $}from"./index-R2TWhfhS.js";import{_ as j}from"./DateRangeUsageBarChart.vue_vue_type_script_setup_true_lang-DpB7zVBj.js";import{_ as q}from"./ProcessUsageList.vue_vue_type_script_setup_true_lang-CGd8xghQ.js";import"./UsageBarChart.vue_vue_type_script_setup_true_lang-AEtCIuq9.js";const L=x("monthlyUsage",()=>{const m=c({}),l=c({});return{monthUsageSummaries:m,topProcessessUsages:l,getMonthUsageSummary:async e=>{if(!m.value[e]){let t=f(e);u(new Date)===e?t.setDate(t.getDate()-29):t.setDate(1);const a=await D.getUsageSummaryRange(u(t),e);m.value[e]=a}return m.value[e]},getTopProcessessUsage:async e=>{if(!l.value[e]){let t=f(e);u(new Date)===e?t.setDate(t.getDate()-29):t.setDate(1);const a=await D.getTopProcessesUsageRange(u(t),e,10);l.value[e]=a}return l.value[e]}}}),z={class:"mt-4 card"},G={class:"flex flex-col gap-2 items-center"},H={class:"content-switcher"},J=["disabled"],K={class:"w-full"},Q={class:"mt-4 card"},ee=k({__name:"MonthlyScreenTime",setup(m){const l=C(),g=F(),v=L(),e=c(parseInt(l.params.monthsAgo)||0),t=c(new Date),a=c(new Date),h=c([]),_=c([]),M=b(()=>h.value.reduce((s,o)=>s+o.durationMs,0)),S=()=>{g.push({name:"MonthlyScreenTime",params:{monthsAgo:(e.value+1).toString()}})},U=()=>{g.push({name:"MonthlyScreenTime",params:{monthsAgo:(e.value-1).toString()}})},P=s=>{g.push({name:"DateRangeProcessUsage",params:{processName:s,startDate:u(t.value),endDate:u(a.value)}})},T=(s,o=1)=>{const r=new Date(s);return r.setMonth(r.getMonth()+1-o,1),r.setDate(0),r},d=async()=>{if(e.value===0){a.value=new Date;const o=new Date(a.value);o.setDate(o.getDate()-29),t.value=o}else{a.value=T(new Date,e.value);const o=new Date(a.value);o.setDate(1),t.value=o}const s=u(a.value);h.value=await v.getMonthUsageSummary(s),_.value=await v.getTopProcessessUsage(s)};return A(async()=>{await d()}),R(()=>l.params.monthsAgo,async s=>{e.value=parseInt(s)||0,await d()}),(s,o)=>{const r=B("el-icon");return $(),I(E,null,[n("div",z,[n("div",G,[n("div",H,[n("button",{onClick:S,class:"flex items-center cursor-pointer"},[i(r,null,{default:y(()=>[i(p(O))]),_:1})]),n("span",null,N(e.value===0?"近30天":e.value===1?"上月":p(w)(t.value)+"-"+p(w)(a.value))+"使用时长 ",1),n("button",{onClick:U,disabled:e.value===0,class:"flex items-center cursor-pointer"},[i(r,null,{default:y(()=>[i(p(V))]),_:1})],8,J)])]),n("div",K,[i(j,{usage:h.value},null,8,["usage"])])]),n("div",Q,[i(q,{usage:_.value,totalDurationMs:M.value,onItemClick:P},null,8,["usage","totalDurationMs"])])],64)}}});export{ee as default};
