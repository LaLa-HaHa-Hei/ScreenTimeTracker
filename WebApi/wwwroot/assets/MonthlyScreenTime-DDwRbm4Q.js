import{e as C,f as u,v as y,p as c,g as D,h as A,u as I,i as w,j as R,k as B,c as N,a as n,b as i,w as M,r as E,t as S,l as g,m as U,F,n as O,q as V,s as $,o as j}from"./index-Bwu9Iw44.js";import{f as q}from"./process-DsZC-9zr.js";import{_ as L}from"./MonthlyUsageChart.vue_vue_type_script_setup_true_lang-IELNji9V.js";import{_ as z}from"./ProcessUsageList.vue_vue_type_script_setup_true_lang-BOZPtPOs.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const G=C("monthlyUsage",()=>{const m=u({}),l=u({});return{monthUsageSummaries:m,topProcessessUsages:l,getMonthUsageSummary:async e=>{if(!m.value[e]){let t=y(e);c(new Date)===e?t.setDate(t.getDate()-29):t.setDate(1);const a=await D.getUsageSummaryRange(c(t),e);m.value[e]=a}return m.value[e]},getTopProcessessUsage:async e=>{if(!l.value[e]){let t=y(e);c(new Date)===e?t.setDate(t.getDate()-29):t.setDate(1);const a=await D.getTopProcessesUsageRange(c(t),e,10);l.value[e]=a}return l.value[e]}}}),H={class:"rounded-xl mt-4 p-4 bg-white dark:bg-neutral-800"},J={class:"flex flex-col gap-2 items-center"},K={class:"flex items-center border border-gray-400 rounded-full py-1 px-2"},Q=["disabled"],W={class:"font-bold text-lg"},X={class:"w-full"},Y={class:"rounded-xl mt-4 p-4 bg-white dark:bg-neutral-800"},oe=A({__name:"MonthlyScreenTime",setup(m){const l=I(),p=O(),d=G(),e=u(parseInt(l.params.monthsAgo)||0),t=u(new Date),a=u(new Date),v=u([]),h=u([]),_=w(()=>v.value.reduce((s,o)=>s+o.durationMs,0)),x=w(()=>_.value/v.value.length),b=()=>{p.push({name:"MonthlyScreenTime",params:{monthsAgo:(e.value+1).toString()}})},P=()=>{p.push({name:"MonthlyScreenTime",params:{monthsAgo:(e.value-1).toString()}})},k=s=>{p.push({name:"MonthlyProcessUsage",params:{processName:s,startDate:c(t.value),endDate:c(a.value)}})},T=(s,o=1)=>{const r=new Date(s);return r.setMonth(r.getMonth()+1-o,1),r.setDate(0),r},f=async()=>{if(e.value===0){a.value=new Date;const o=new Date(a.value);o.setDate(o.getDate()-29),t.value=o}else{a.value=T(new Date,e.value);const o=new Date(a.value);o.setDate(1),t.value=o}const s=c(a.value);v.value=await d.getMonthUsageSummary(s),h.value=await d.getTopProcessessUsage(s)};return R(async()=>{await f()}),B(()=>l.params.monthsAgo,async s=>{e.value=parseInt(s)||0,await f()}),(s,o)=>{const r=E("el-icon");return j(),N(F,null,[n("div",H,[n("div",J,[n("div",K,[n("button",{onClick:b,class:"flex items-center cursor-pointer"},[i(r,null,{default:M(()=>[i(g(V))]),_:1})]),n("span",null,S(e.value===0?"近30天":e.value===1?"上月":g(U)(t.value)+"-"+g(U)(a.value))+"使用时长",1),n("button",{onClick:P,disabled:e.value===0,class:"flex items-center cursor-pointer"},[i(r,null,{default:M(()=>[i(g($))]),_:1})],8,Q)]),n("span",W,"日均 "+S(g(q)(x.value)),1)]),n("div",X,[i(L,{usage:v.value},null,8,["usage"])])]),n("div",Y,[i(z,{usage:h.value,totalDurationMs:_.value,onItemClick:k},null,8,["usage","totalDurationMs"])])],64)}}});export{oe as default};
