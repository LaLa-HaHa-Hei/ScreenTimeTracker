import{e as M,f as u,g as A,u as I,h as k,i as R,j as B,c as N,a as o,b as c,w as D,r as E,t as h,k as m,F,l as O,m as V,n as $,o as j}from"./index-BExF4c4S.js";import{d as g,f as S}from"./date-xHdT8iMX.js";import{a as U,f as q}from"./process-BdcFep0L.js";import{_ as z}from"./WeeklyUsageChart.vue_vue_type_script_setup_true_lang-BAMNNSrL.js";import{_ as G}from"./ProcessUsageList.vue_vue_type_script_setup_true_lang-V6E3C4p_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const H=M("weeklyUsage",()=>{const i=u({}),n=u({});return{weekUsageSummaries:i,topProcessessUsages:n,getWeekUsageSummary:async e=>{if(!i.value[e]){const a=new Date(e);a.setDate(a.getDate()-6);const t=await U.getUsageSummaryRange(g(a),e);i.value[e]=t}return i.value[e]},getTopProcessessUsage:async e=>{if(!n.value[e]){const a=new Date(e);a.setDate(a.getDate()-6);const t=await U.getTopProcessesUsageRange(g(a),e,10);n.value[e]=t}return n.value[e]}}}),J={class:"rounded-xl mt-4 p-4 bg-white dark:bg-neutral-800"},K={class:"flex flex-col gap-2 items-center"},L={class:"flex items-center border border-gray-400 rounded-full py-1 px-2"},Q=["disabled"],X={class:"font-bold text-lg"},Y={class:"w-full"},Z={class:"rounded-xl mt-4 p-4 bg-white dark:bg-neutral-800"},re=A({__name:"WeeklyScreenTime",setup(i){const n=I(),p=O(),v=H(),e=u(parseInt(n.params.weeksAgo)||0),a=u(new Date),t=u(new Date),d=u([]),_=u([]),f=k(()=>d.value.reduce((s,r)=>s+r.durationMs,0)),b=k(()=>f.value/d.value.length),x=()=>{p.push({name:"WeeklyScreenTime",params:{weeksAgo:(e.value+1).toString()}})},P=()=>{p.push({name:"WeeklyScreenTime",params:{weeksAgo:(e.value-1).toString()}})},W=s=>{p.push({name:"WeeklyProcessUsage",params:{processName:s,startDate:g(a.value),endDate:g(t.value)}})},T=(s,r=1)=>{const l=new Date(s),y=l.getDay(),C=(y===0?7:y)+7*(r-1);return l.setDate(l.getDate()-C),l},w=async()=>{e.value===0?t.value=new Date:t.value=T(new Date,e.value);const s=new Date;s.setDate(t.value.getDate()-6),a.value=s;const r=g(t.value);d.value=await v.getWeekUsageSummary(r),_.value=await v.getTopProcessessUsage(r)};return R(async()=>{await w()}),B(()=>n.params.weeksAgo,async s=>{e.value=parseInt(s)||0,await w()}),(s,r)=>{const l=E("el-icon");return j(),N(F,null,[o("div",J,[o("div",K,[o("div",L,[o("button",{onClick:x,class:"flex items-center cursor-pointer"},[c(l,null,{default:D(()=>[c(m(V))]),_:1})]),o("span",null,h(e.value===0?"近7天":e.value===1?"上周":m(S)(a.value)+"-"+m(S)(t.value))+"使用时长",1),o("button",{onClick:P,disabled:e.value===0,class:"flex items-center cursor-pointer"},[c(l,null,{default:D(()=>[c(m($))]),_:1})],8,Q)]),o("span",X,"日均 "+h(m(q)(b.value)),1)]),o("div",Y,[c(z,{usage:d.value},null,8,["usage"])])]),o("div",Z,[c(G,{usage:_.value,totalDurationMs:f.value,onItemClick:W},null,8,["usage","totalDurationMs"])])],64)}}});export{re as default};
