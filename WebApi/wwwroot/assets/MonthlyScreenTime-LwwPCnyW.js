import{e as C,f as u,g as A,u as I,h as y,i as R,j as B,c as N,a as n,b as i,w as D,r as E,t as w,k as g,F,l as O,m as V,n as $,o as j}from"./index-BExF4c4S.js";import{a as M,d as c,f as S}from"./date-xHdT8iMX.js";import{a as U,f as L}from"./process-BdcFep0L.js";import{_ as q}from"./MonthlyUsageChart.vue_vue_type_script_setup_true_lang-BvTTuioV.js";import{_ as z}from"./ProcessUsageList.vue_vue_type_script_setup_true_lang-V6E3C4p_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const G=C("monthlyUsage",()=>{const m=u({}),l=u({});return{monthUsageSummaries:m,topProcessessUsages:l,getMonthUsageSummary:async e=>{if(!m.value[e]){let t=M(e);c(new Date)===e?t.setDate(t.getDate()-29):t.setDate(1);const a=await U.getUsageSummaryRange(c(t),e);m.value[e]=a}return m.value[e]},getTopProcessessUsage:async e=>{if(!l.value[e]){let t=M(e);c(new Date)===e?t.setDate(t.getDate()-29):t.setDate(1);const a=await U.getTopProcessesUsageRange(c(t),e,10);l.value[e]=a}return l.value[e]}}}),H={class:"rounded-xl mt-4 p-4 bg-white dark:bg-neutral-800"},J={class:"flex flex-col gap-2 items-center"},K={class:"flex items-center border border-gray-400 rounded-full py-1 px-2"},Q=["disabled"],W={class:"font-bold text-lg"},X={class:"w-full"},Y={class:"rounded-xl mt-4 p-4 bg-white dark:bg-neutral-800"},ne=A({__name:"MonthlyScreenTime",setup(m){const l=I(),p=O(),d=G(),e=u(parseInt(l.params.monthsAgo)||0),t=u(new Date),a=u(new Date),v=u([]),h=u([]),f=y(()=>v.value.reduce((s,o)=>s+o.durationMs,0)),x=y(()=>f.value/v.value.length),b=()=>{p.push({name:"MonthlyScreenTime",params:{monthsAgo:(e.value+1).toString()}})},P=()=>{p.push({name:"MonthlyScreenTime",params:{monthsAgo:(e.value-1).toString()}})},k=s=>{p.push({name:"MonthlyProcessUsage",params:{processName:s,startDate:c(t.value),endDate:c(a.value)}})},T=(s,o=1)=>{const r=new Date(s);return r.setMonth(r.getMonth()+1-o,1),r.setDate(0),r},_=async()=>{if(e.value===0){a.value=new Date;const o=new Date(a.value);o.setDate(o.getDate()-29),t.value=o}else{a.value=T(new Date,e.value);const o=new Date(a.value);o.setDate(1),t.value=o}const s=c(a.value);v.value=await d.getMonthUsageSummary(s),h.value=await d.getTopProcessessUsage(s)};return R(async()=>{await _()}),B(()=>l.params.monthsAgo,async s=>{e.value=parseInt(s)||0,await _()}),(s,o)=>{const r=E("el-icon");return j(),N(F,null,[n("div",H,[n("div",J,[n("div",K,[n("button",{onClick:b,class:"flex items-center cursor-pointer"},[i(r,null,{default:D(()=>[i(g(V))]),_:1})]),n("span",null,w(e.value===0?"近30天":e.value===1?"上月":g(S)(t.value)+"-"+g(S)(a.value))+"使用时长",1),n("button",{onClick:P,disabled:e.value===0,class:"flex items-center cursor-pointer"},[i(r,null,{default:D(()=>[i(g($))]),_:1})],8,Q)]),n("span",W,"日均 "+w(g(L)(x.value)),1)]),n("div",X,[i(q,{usage:v.value},null,8,["usage"])])]),n("div",Y,[i(z,{usage:h.value,totalDurationMs:f.value,onItemClick:k},null,8,["usage","totalDurationMs"])])],64)}}});export{ne as default};
