import{e as C,f as l,g as k,p as m,h as b,u as x,i as M,j as A,k as I,c as R,a as o,b as u,w as f,r as B,t as N,l as p,m as D,F as E,n as F,q as O,s as V,o as $}from"./index-C3m9QwJv.js";import{_ as j}from"./WeeklyUsageBarChart.vue_vue_type_script_setup_true_lang-4MEGcws9.js";import{_ as q}from"./ProcessUsageList.vue_vue_type_script_setup_true_lang-gTi2BlsX.js";import"./UsageBarChart.vue_vue_type_script_setup_true_lang-Bw2oqX_d.js";const z=C("weeklyUsage",()=>{const i=l({}),n=l({});return{weekUsageSummaries:i,topProcessessUsages:n,getWeekUsageSummary:async e=>{if(!i.value[e]){const a=new Date(e);a.setDate(a.getDate()-6);const t=await k.getUsageSummaryRange(m(a),e);i.value[e]=t}return i.value[e]},getTopProcessessUsage:async e=>{if(!n.value[e]){const a=new Date(e);a.setDate(a.getDate()-6);const t=await k.getTopProcessesUsageRange(m(a),e,10);n.value[e]=t}return n.value[e]}}}),G={class:"mt-4 card"},H={class:"flex flex-col gap-2 items-center"},J={class:"content-switcher"},K=["disabled"],L={class:"w-full"},Q={class:"mt-4 card"},ae=b({__name:"WeeklyScreenTime",setup(i){const n=x(),g=F(),v=z(),e=l(parseInt(n.params.weeksAgo)||0),a=l(new Date),t=l(new Date),d=l([]),_=l([]),S=M(()=>d.value.reduce((s,r)=>s+r.durationMs,0)),h=()=>{g.push({name:"WeeklyScreenTime",params:{weeksAgo:(e.value+1).toString()}})},U=()=>{g.push({name:"WeeklyScreenTime",params:{weeksAgo:(e.value-1).toString()}})},P=s=>{g.push({name:"WeeklyProcessUsage",params:{processName:s,startDate:m(a.value),endDate:m(t.value)}})},W=(s,r=1)=>{const c=new Date(s),y=c.getDay(),T=(y===0?7:y)+7*(r-1);return c.setDate(c.getDate()-T),c},w=async()=>{e.value===0?t.value=new Date:t.value=W(new Date,e.value);const s=new Date;s.setDate(t.value.getDate()-6),a.value=s;const r=m(t.value);d.value=await v.getWeekUsageSummary(r),_.value=await v.getTopProcessessUsage(r)};return A(async()=>{await w()}),I(()=>n.params.weeksAgo,async s=>{e.value=parseInt(s)||0,await w()}),(s,r)=>{const c=B("el-icon");return $(),R(E,null,[o("div",G,[o("div",H,[o("div",J,[o("button",{onClick:h},[u(c,null,{default:f(()=>[u(p(O))]),_:1})]),o("span",null,N(e.value===0?"近7天":e.value===1?"上周":p(D)(a.value)+"-"+p(D)(t.value))+"使用时长 ",1),o("button",{onClick:U,disabled:e.value===0},[u(c,null,{default:f(()=>[u(p(V))]),_:1})],8,K)])]),o("div",L,[u(j,{usage:d.value},null,8,["usage"])])]),o("div",Q,[u(q,{usage:_.value,totalDurationMs:S.value,onItemClick:P},null,8,["usage","totalDurationMs"])])],64)}}});export{ae as default};
